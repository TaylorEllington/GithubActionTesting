name: Github PR Audit

on:
  pull_request:
    types:
      - opened
      - edited
      - labeled
      - unlabeled
      
  issue_comment:
    types:
      - created
      - edited
      - deleted
jobs:
  Audit-Pull-Request:
    runs-on: ubuntu-latest
        
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Fetch Labels
        id: fetch-labels
        uses: actions/github-script@v6
        with: 
          script: |
            return github.rest.issues.listLabelsOnIssue({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              });
                    
      - name: Print Labels
        uses: ./pr-audit-action
        with:
          response: "${{steps.fetch-labels.outputs.result}}"
          repoOwner: ${{ github.repository_owner }}
          repoName: ${{ github.repository.replace(github.repository_owner+'/', '')}}
          pullNumber: ${{JSON.parse(  fs.readFileSync(process.env.GITHUB_EVENT_PATH, 'utf8').pull_request.number }}
          myToken: ${{secrets.GITHUB_TOKEN}}
  
